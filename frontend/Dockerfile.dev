# Build Stage
FROM node:23-alpine AS build

# Install required build tools
RUN apk add --no-cache python3 make g++

WORKDIR /app

# Enable corepack
RUN corepack enable

# Copy package.json and lockfile first (for better layer caching)
COPY package.json pnpm-lock.yaml* ./

COPY .env /app/.env

# Install dependencies (pnpm version is read from package.json -> packageManager field)
RUN pnpm install --frozen-lockfile

COPY . .

# Start Vite in dev mode
CMD ["pnpm", "dev"]